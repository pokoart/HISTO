<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Video Přehrávač</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000;
            touch-action: none;
        }

        #videoContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.1s ease-out;
            transform-origin: center center;
        }

        #controlContainer {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
            height: 280px;
            z-index: 100;
        }

        #controlWheel {
            position: absolute;
            width: 100%;
            height: 100%;
            transition: transform 0.1s ease-out;
        }




        #debugInfo {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-family: monospace;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            z-index: 200;
            display: none;
        }
    </style>
</head>
<body>
    <div id="videoContainer">
        <video id="video" playsinline webkit-playsinline>
            <source src="video.mp4" type="video/mp4">
        </video>
    </div>

    <div id="controlContainer">
        <img id="controlWheel" src="control.png" alt="Control">
    </div>

    <div id="debugInfo"></div>

    <script>
        const video = document.getElementById('video');
        const controlWheel = document.getElementById('controlWheel');
        const controlContainer = document.getElementById('controlContainer');
        const debugInfo = document.getElementById('debugInfo');

        let isDragging = false;
        let startX = 0;
        let startY = 0;
        let centerX = 0;
        let centerY = 0;
        let currentAngle = 0;
        let currentDistance = 0;
        let isPlaying = false;
        let currentZoom = 1;
        let seekInterval = null;
        let initialTime = 0;

        // Funkce pro výpočet úhlu a vzdálenosti od středu
        function calculateAngleAndDistance(x, y) {
            const dx = x - centerX;
            const dy = y - centerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            let angle = Math.atan2(dy, dx) * (180 / Math.PI);
            
            // Normalizace úhlu na 0-360
            angle = (angle + 360) % 360;
            
            return { angle, distance };
        }

        // Určení sektoru podle úhlu
        function getSector(angle) {
            // Video zpět: 180-315°
            if (angle >= 180 && angle < 315) {
                return 'backward';
            }
            // Zoom: 315-45° (přes 0°)
            else if (angle >= 315 || angle < 45) {
                return 'zoom';
            }
            // Video vpřed: 45-180°
            else if (angle >= 45 && angle < 180) {
                return 'forward';
            }
        }

        // Rotace kolečka podle úhlu
        function rotateWheel(angle) {
            controlWheel.style.transform = `rotate(${angle}deg)`;
        }

        // Přehrávání/pauza (klik bez tažení)
        function togglePlayPause() {
            if (video.paused) {
                video.play();
                isPlaying = true;
            } else {
                video.pause();
                isPlaying = false;
            }
        }

        // Posun videa vzad/vpřed
        function seekVideo(distance, sector) {
            const maxDistance = 100; // Maximální vzdálenost pro plnou rychlost
            const normalizedDistance = Math.min(distance, maxDistance) / maxDistance;
            
            // Rychlost posunu (sekundy za frame)
            const seekSpeed = normalizedDistance * 0.5; // 0-0.5 sekund za frame
            
            if (sector === 'backward') {
                video.currentTime = Math.max(0, video.currentTime - seekSpeed);
            } else if (sector === 'forward') {
                video.currentTime = Math.min(video.duration, video.currentTime + seekSpeed);
            }
        }

        // Zoom videa
        function zoomVideo(distance) {
            const maxDistance = 100;
            const normalizedDistance = Math.min(distance, maxDistance) / maxDistance;
            
            // Zoom od 1x do 3x
            currentZoom = 1 + (normalizedDistance * 2);
            video.style.transform = `scale(${currentZoom})`;
        }

        // Debug info
        function updateDebugInfo(angle, distance, sector) {
            debugInfo.innerHTML = `
                Angle: ${angle.toFixed(1)}°<br>
                Distance: ${distance.toFixed(1)}px<br>
                Sector: ${sector}<br>
                Time: ${video.currentTime.toFixed(2)}s<br>
                Zoom: ${currentZoom.toFixed(2)}x<br>
                Playing: ${!video.paused}
            `;
        }

        // Touch/Mouse start
        function handleStart(e) {
            e.preventDefault();
            isDragging = true;
            
            const touch = e.touches ? e.touches[0] : e;
            startX = touch.clientX;
            startY = touch.clientY;
            
            const rect = controlContainer.getBoundingClientRect();
            centerX = rect.left + rect.width / 2;
            centerY = rect.top + rect.height / 2;
            
            initialTime = video.currentTime;
        }

        // Touch/Mouse move
        function handleMove(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            const touch = e.touches ? e.touches[0] : e;
            const x = touch.clientX;
            const y = touch.clientY;
            
            const { angle, distance } = calculateAngleAndDistance(x, y);
            currentAngle = angle;
            currentDistance = distance;
            
            const sector = getSector(angle);
            
            // Rotace kolečka
            rotateWheel(angle);
            
            // Akce podle sektoru
            if (distance > 20) { // Minimální vzdálenost pro aktivaci
                if (sector === 'zoom') {
                    zoomVideo(distance);
                } else if (sector === 'backward' || sector === 'forward') {
                    seekVideo(distance, sector);
                }
            }
            
            // updateDebugInfo(angle, distance, sector);
        }

        // Touch/Mouse end
        function handleEnd(e) {
            e.preventDefault();
            
            if (isDragging) {
                // Pokud bylo jen krátké kliknutí (malý pohyb)
                const touch = e.changedTouches ? e.changedTouches[0] : e;
                const moveDistance = Math.sqrt(
                    Math.pow(touch.clientX - startX, 2) + 
                    Math.pow(touch.clientY - startY, 2)
                );
                
                if (moveDistance < 10) {
                    togglePlayPause();
                }
                
                // Reset
                isDragging = false;
                controlWheel.style.transform = 'rotate(0deg)';
                
                // Reset zoomu plynule
                if (currentZoom !== 1) {
                    video.style.transition = 'transform 0.3s ease-out';
                    video.style.transform = 'scale(1)';
                    setTimeout(() => {
                        video.style.transition = 'transform 0.1s ease-out';
                    }, 300);
                    currentZoom = 1;
                }
            }
        }

        // Event listeners
        controlWheel.addEventListener('touchstart', handleStart, { passive: false });
        controlWheel.addEventListener('touchmove', handleMove, { passive: false });
        controlWheel.addEventListener('touchend', handleEnd, { passive: false });
        
        controlWheel.addEventListener('mousedown', handleStart);
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('mouseup', handleEnd);

        // Inicializace videa
        video.addEventListener('loadedmetadata', () => {
            console.log('Video loaded, duration:', video.duration);
        });

        // Prevent default touch behaviors
        document.addEventListener('touchmove', (e) => {
            if (isDragging) {
                e.preventDefault();
            }
        }, { passive: false });

        // Debug toggle (double tap on video)
        let lastTap = 0;
        video.addEventListener('touchend', (e) => {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            if (tapLength < 300 && tapLength > 0) {
                debugInfo.style.display = debugInfo.style.display === 'none' ? 'block' : 'none';
            }
            lastTap = currentTime;
        });
    </script>
</body>
</html>
